<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Edit Event | SMU Event Helpers</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    /* Use your provided styles here */
    body { background: linear-gradient(135deg, #d6e4ff, #f8f9fa); min-height: 100vh; display: flex; justify-content: center; align-items: center; font-family: "Poppins", sans-serif; }
    .card { max-width: 600px; border: none; border-radius: 20px; box-shadow: 0 6px 25px rgba(0,0,0,0.1); overflow: hidden; background-color: #fff; transition: all 0.3s ease-in-out; }
    .card:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.12); }
    .card-header { background: #004aad; color: #fff; text-align: center; padding: 1.5rem; }
    .form-label { font-weight: 500; color: #333; }
    .btn-success { background-color: #28a745; border: none; font-weight: 600; transition: background-color 0.3s ease-in-out; }
    .btn-success:hover { background-color: #218838; }
    input, textarea { border-radius: 10px !important; }
    .form-control:focus { border-color: #004aad; box-shadow: 0 0 0 0.2rem rgba(0,74,173,0.25); }
    footer { text-align: center; margin-top: 30px; font-size: 0.9rem; color: #666; }
  </style>
</head>
<body>
  <div class="card">
    <div class="card-header">
      <h2 class="mb-0"><i class="bi bi-pencil-square me-2"></i>Edit Event</h2>
    </div>
    <div class="card-body p-4">
      <form id="eventEditForm">
        <div class="mb-3">
          <label for="eventName" class="form-label">Name of Event</label>
          <input type="text" class="form-control" id="eventName" name="eventName" required />
        </div>
        <div class="mb-3">
          <label for="eventLocation" class="form-label">Location</label>
          <input type="text" class="form-control" id="eventLocation" name="eventLocation" required />
        </div>
        <div class="mb-3">
          <label for="eventDescription" class="form-label">Event Description</label>
          <textarea class="form-control" id="eventDescription" name="eventDescription" rows="3"></textarea>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="manpower" class="form-label">Manpower Needed</label>
            <input type="number" class="form-control" id="manpower" name="manpower" min="1" required />
          </div>
          <div class="col-md-6 mb-3">
            <label for="rewardPoints" class="form-label">Reward Points</label>
            <input type="number" class="form-control" id="rewardPoints" name="rewardPoints" min="0" />
          </div>
        </div>
        <div class="mb-3">
          <label for="qualifications" class="form-label">Qualifications Needed</label>
          <input type="text" class="form-control" id="qualifications" name="qualifications" />
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="startDatetime" class="form-label">Start Date & Time</label>
            <input type="datetime-local" class="form-control" id="startDatetime" name="startDatetime" required />
          </div>
          <div class="col-md-6 mb-3">
            <label for="endDatetime" class="form-label">End Date & Time</label>
            <input type="datetime-local" class="form-control" id="endDatetime" name="endDatetime" required />
          </div>
        </div>
        <button type="submit" class="btn btn-success w-100 py-2 mt-2">
          <i class="bi bi-pencil-square me-2"></i>Update Event
        </button>
      </form>
    </div>
  </div>
<!-- Firebase & Firestore integration and code -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyByPrDz810_ttwZz0BdAJkeP54rMIqH3uw",
  authDomain: "wad2-505be.firebaseapp.com",
  databaseURL: "https://wad2-505be-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "wad2-505be",
  storageBucket: "wad2-505be.firebasestorage.app",
  messagingSenderId: "221863917439",
  appId: "1:221863917439:web:2a517ca11c83e991388c4a",
  measurementId: "G-L69GG585GF"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// Extract eventId from URL
function getEventId() {
  const params = new URLSearchParams(window.location.search);
  return params.get("eventId");
}

let user = null;
const eventId = getEventId();

onAuthStateChanged(auth, async (u) => {
  if (!u) {
    alert("You must be logged in to edit events!");
    window.location.href = "../loginPage_file/login.html";
    return;
  }
  user = u;

  // Get existing event data and prefill form
  const docRef = doc(db, "events", eventId);
  const eventSnap = await getDoc(docRef);
  if (eventSnap.exists()) {
    const event = eventSnap.data();
    document.getElementById("eventName").value = event.name || "";
    document.getElementById("eventLocation").value = event.location || "";
    document.getElementById("eventDescription").value = event.description || "";
    document.getElementById("manpower").value = event.manpower || 1;
    document.getElementById("rewardPoints").value = event.rewardPoints || 0;
    document.getElementById("qualifications").value = event.qualifications || "";
    document.getElementById("startDatetime").value = event.startDatetime || "";
    document.getElementById("endDatetime").value = event.endDatetime || "";
  } else {
    alert("Event not found!");
    window.location.href = "../homePage/events.html";
    return;
  }

  // Submit handler to update Firestore doc
  const form = document.getElementById("eventEditForm");
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = {
      name: document.getElementById("eventName").value.trim(),
      location: document.getElementById("eventLocation").value.trim(),
      description: document.getElementById("eventDescription").value.trim(),
      manpower: parseInt(document.getElementById("manpower").value),
      qualifications: document.getElementById("qualifications").value.trim(),
      startDatetime: document.getElementById("startDatetime").value,
      endDatetime: document.getElementById("endDatetime").value,
      rewardPoints: parseInt(document.getElementById("rewardPoints").value),
    };

    try {
      await updateDoc(docRef, data);
      window.location.href = "../homePage/events.html";
    } catch (error) {
      console.error("Error updating event:", error);
      alert("Failed to update event. Check console for details.");
    }
  });
});
</script>
</body>
</html>
