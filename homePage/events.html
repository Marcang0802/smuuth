<!DOCTYPE html>
<html lang="zxx" class="no-js">

<head>
    <!-- Mobile Specific Meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Favicon-->
    <link rel="shortcut icon" href="img/fav.png">
    <!-- Author Meta -->
    <meta name="author" content="codepixer">
    <!-- Meta Description -->
    <meta name="description" content="">
    <!-- Meta Keyword -->
    <meta name="keywords" content="">
    <!-- meta character set -->
    <meta charset="UTF-8">
    <!-- Site Title -->
    <title>Smuuth Events</title>

    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,400,300,500,600,700" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="css/linearicons.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/nice-select.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/owl.carousel.css">
    <link rel="stylesheet" href="css/main.css">
</head>

<body>

    <header id="header" id="home">
        <div class="container">
            <div class="row align-items-center justify-content-between d-flex">
                <div id="logo">
                    <a href="index.html"><img src="img/SMUUTH_words_pastel_ultraclean.png" alt="SMUUTH"
                            style="height:48px;width:auto;display:block"></a>
                </div>
                <nav id="nav-menu-container">
                    <ul class="nav-menu">
                        <li class="menu-active"><a href="index.html">Home</a></li>
						<li><a href="about-us.html">About Us</a></li>
						<li><a href="events.html">Events</a></li>
						<li><a href="calendar.html">Calendar</a></li>
						<li><a href="points.html">Points</a></li>
						<li><a class="ticker-btn" href="../review/event_feedback.html">Feedback Form</a></li>
						<li>
							<a href="../loginPage_file/ViewProfile.html" class="profile-icon-btn" aria-label="Profile">
								<i class="fa fa-user"></i>
							</a>
						</li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- start banner Area -->
    <section class="banner-area relative" id="home">
        <div class="overlay overlay-bg"></div>
        <div class="container">
            <div class="row d-flex align-items-center justify-content-center">
                <div class="about-content col-lg-12">
                    <h1 class="text-white">Events</h1>
                    <p class="text-white link-nav"><a href="index.html">Home </a> <span
                            class="lnr lnr-arrow-right"></span> <a href="events.html">Events</a></p>
                </div>
            </div>
        </div>
    </section>
    <!-- End banner Area -->

	<!-- Start post Area -->
	<section class="post-area section-gap">
		<div class="container">
			<div class="row justify-content-center d-flex">
				<div class="col-lg-8 post-list" id="event-list">
					<div class="single-post job-listing d-flex flex-row" data-category="clubs">
						<div class="thumb">
							<img src="img/post.png" alt="">

						</div>
						<div class="post-content d-flex flex-column">
							<div class="details">
								<div class="title">
									<a href="#">
										<h4>Registration Crew</h4>
									</a>
									<h6>ASMU</h6>
								</div>
								<p>
									Support general event logistics such as setting up booths, managing crowds, and
									assisting committees with on-site tasks.
								</p>
								<h5>Job Nature: Full Event</h5>
								<p class="address"><span class="lnr lnr-map"></span> VIVACE</p>
								<p class="address"><span class="lnr lnr-database"></span> 10 points</p>
							</div>

							<div class="job-meta">
								<h4>Whom we are looking for</h4>
								<p>Responsible, punctual individuals who can adapt to different tasks quickly.</p>
							</div>

							<div class="job-meta">
								<h4>Experience Requirements</h4>
								<ul>
									<li>
										<img src="img/pages/list.jpg" alt="">
										<span>No prior experience required — ideal for first-time volunteers.</span>
									</li>
								</ul>
							</div>
						</div>


					</div>

					<div class="single-post job-listing d-flex flex-row" data-category="clubs">
						<div class="thumb">
							<img src="img/post.png" alt="">

						</div>
						<div class="post-content d-flex flex-column">
							<div class="details">
								<div class="title">
									<a href="#">
										<h4>Booth Attendant</h4>
									</a>
									<h6>SMUB</h6>
								</div>
								<p>
									Manage event or sponsor booths, distribute materials, and answer basic enquiries.
								</p>
								<h5>Job Nature: Full Event</h5>
								<p class="address"><span class="lnr lnr-map"></span> VIVACE</p>
								<p class="address"><span class="lnr lnr-database"></span> 10 points</p>
							</div>

							<div class="job-meta">
								<h4>Whom we are looking for</h4>
								<p>Outgoing and approachable helpers who enjoy interacting with people.</p>
							</div>

							<div class="job-meta">
								<h4>Experience Requirements</h4>
								<ul>
									<li>
										<img src="img/pages/list.jpg" alt="">
										<span>Prior customer service or public engagement experience is an
											advantage.</span>
									</li>
								</ul>
							</div>
						</div>
					</div>

					<div class="single-post job-listing d-flex flex-row" data-category="performing-arts">
						<div class="thumb">
							<img src="img/post.png" alt="">

						</div>
						<div class="post-content d-flex flex-column">
							<div class="details">
								<div class="title">
									<a href="#">
										<h4>Stage Crew</h4>
									</a>
									<h6>SMUB</h6>
								</div>
								<p>
									Assist with stage setup, cue management, and transitions between performances.
								</p>
								<h5>Job Nature: Full Event</h5>
								<p class="address"><span class="lnr lnr-map"></span> VIVACE</p>
								<p class="address"><span class="lnr lnr-database"></span> 10 points</p>
							</div>

							<div class="job-meta">
								<h4>Whom we are looking for</h4>
								<p>Calm and focused students who can follow instructions under pressure.</p>
							</div>

							<div class="job-meta">
								<h4>Experience Requirements</h4>
								<ul>
									<li>
										<img src="img/pages/list.jpg" alt="">
										<span>Preferably has experience with stage, theatre, or AV setups.</span>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-4 sidebar">
					<div class="single-slidebar">
						<h3>Create an event!</h3>
						<br>
						<a class="ticker-btn" href="../eventCreation/eventCreate.html">Create Event</a>
						<div class="eventImg">
							<img class="img-fluid" src="img/eventCreate.jpg" alt="eventPhoto.jpg">
						</div>
						<!-- <div class="active-relatedjob-carusel">
								<div class="single-rated">
									<img class="img-fluid" src="img/r1.jpg" alt="">
									<a href="single.html"><h4>Creative Art Designer</h4></a>
									<h6>Premium Labels Limited</h6>
									<p>
										Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod temporinc ididunt ut dolore magna aliqua.
									</p>
									<h5>Job Nature: Full time</h5>
									<p class="address"><span class="lnr lnr-map"></span> 56/8, Panthapath Dhanmondi Dhaka</p>
									<p class="address"><span class="lnr lnr-database"></span> 15k - 25k</p>
									<a href="#" class="btns text-uppercase">Apply job</a>
								</div> -->
						<!-- <div class="single-rated">
									<img class="img-fluid" src="img/r1.jpg" alt="">
									<a href="single.html"><h4>Creative Art Designer</h4></a>
									<h6>Premium Labels Limited</h6>
									<p>
										Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod temporinc ididunt ut dolore magna aliqua.
									</p>
									<h5>Job Nature: Full time</h5>
									<p class="address"><span class="lnr lnr-map"></span> 56/8, Panthapath Dhanmondi Dhaka</p>
									<p class="address"><span class="lnr lnr-database"></span> 15k - 25k</p>
									<a href="#" class="btns text-uppercase">Apply job</a>
								</div> -->
						<!-- <div class="single-rated">
									<img class="img-fluid" src="img/r1.jpg" alt="">
									<a href="single.html"><h4>Creative Art Designer</h4></a>
									<h6>Premium Labels Limited</h6>
									<p>
										Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod temporinc ididunt ut dolore magna aliqua.
									</p>
									<h5>Job Nature: Full time</h5>
									<p class="address"><span class="lnr lnr-map"></span> 56/8, Panthapath Dhanmondi Dhaka</p>
									<p class="address"><span class="lnr lnr-database"></span> 15k - 25k</p>
									<a href="#" class="btns text-uppercase">Apply job</a>
								</div>																		 -->
					</div>


                    <div class="single-slidebar">
                        <h4>Events by Category</h4>
                        <ul class="cat-list">
                            <li><a class="justify-content-between d-flex" href="category.html"><p>Technology</p><span>37</span></a></li>
                            <li><a class="justify-content-between d-flex" href="category.html"><p>Media & News</p><span>57</span></a></li>
                            <li><a class="justify-content-between d-flex" href="category.html"><p>Government</p><span>33</span></a></li>
                            <li><a class="justify-content-between d-flex" href="category.html"><p>Medical</p><span>36</span></a></li>
                            <li><a class="justify-content-between d-flex" href="category.html"><p>Restaurants</p><span>47</span></a></li>
                            <li><a class="justify-content-between d-flex" href="category.html"><p>Developer</p><span>27</span></a></li>
                            <li><a class="justify-content-between d-flex" href="category.html"><p>Accounting</p><span>17</span></a></li>
                        </ul>
                    </div>

                </div>
            </div>
        </div>
    </section>
    <!-- End post Area -->

    <!-- Start callto-action Area -->
    <section class="submit-area section-gap">
		<div class="container">
			<div class="row">
				<div class="col-lg-6">
					<div class="submit-left">
						<h4>Find Helpers</h4>
						<p>
							Post your needs and get verified helpers in minutes.
						</p>
						<a href="../eventCreation/eventCreate.html" class="primary-btn header-btn">Post a Job</a>
					</div>
				</div>
				<div class="col-lg-6 ">
					<div class="submit-right">
						<h4>Find Events</h4>
						<p>
							Explore what’s happening around campus today.
						</p>
						<a href="../homePage/events.html" class="primary-btn header-btn">Find Events</a>
					</div>
				</div>

			</div>
		</div>
	</section>
    <!-- End callto-action Area -->

    <!-- start footer Area -->
    <footer class="footer-area section-gap">
        <div class="container">
            <div class="row">
                <div class="col-lg-3  col-md-12">
                    <div class="single-footer-widget">
                        <h6>Top Products</h6>
                        <ul class="footer-nav">
                            <li><a href="#">Managed Website</a></li>
                            <li><a href="#">Manage Reputation</a></li>
                            <li><a href="#">Power Tools</a></li>
                            <li><a href="#">Marketing Service</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-6  col-md-12">
                    <div class="single-footer-widget newsletter">
                        <h6>Newsletter</h6>
                        <p>You can trust us. We only send promo offers, not a single spam.</p>
                        <div id="mc_embed_signup">
                            <form target="_blank" novalidate="true"
                                action="https://spondonit.us12.list-manage.com/subscribe/post?u=1462626880ade1ac87bd9c93a&amp;id=92a4423d01"
                                method="get" class="form-inline">
                                <div class="form-group row" style="width: 100%">
                                    <div class="col-lg-8 col-md-12">
                                        <input name="EMAIL" placeholder="Enter Email"
                                            onfocus="this.placeholder = ''"
                                            onblur="this.placeholder = 'Enter Email '" required="" type="email">
                                        <div style="position: absolute; left: -5000px;">
                                            <input name="b_36c4fd991d266f23781ded980_aefe40901a" tabindex="-1" value=""
                                                type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-12">
                                        <button class="nw-btn primary-btn">Subscribe<span
                                                class="lnr lnr-arrow-right"></span></button>
                                    </div>
                                </div>
                                <div class="info"></div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3  col-md-12">
                    <div class="single-footer-widget mail-chimp">
                        <h6 class="mb-20">Instagram Feed</h6>
                        <ul class="instafeed d-flex flex-wrap">
                            <li><img src="img/i1.jpg" alt=""></li>
                            <li><img src="img/i2.jpg" alt=""></li>
                            <li><img src="img/i3.jpg" alt=""></li>
                            <li><img src="img/i4.jpg" alt=""></li>
                            <li><img src="img/i5.jpg" alt=""></li>
                            <li><img src="img/i6.jpg" alt=""></li>
                            <li><img src="img/i7.jpg" alt=""></li>
                            <li><img src="img/i8.jpg" alt=""></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="row footer-bottom d-flex justify-content-between">
                <p class="col-lg-8 col-sm-12 footer-text m-0 text-white">
                    Copyright &copy;
                    <script>document.write(new Date().getFullYear());</script> All rights reserved | This template is
                    made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com"
                        target="_blank">Colorlib</a>
                </p>
                <div class="col-lg-4 col-sm-12 footer-social">
                    <a href="#"><i class="fa fa-facebook"></i></a>
                    <a href="#"><i class="fa fa-twitter"></i></a>
                    <a href="#"><i class="fa fa-instagram"></i></a>
                    <!-- <a href="#"><i class="fa fa-tiktok"></i></a> -->
                </div>
            </div>
        </div>
    </footer>
    <!-- End footer Area -->

    <script src="js/vendor/jquery-2.2.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="js/vendor/bootstrap.min.js"></script>
    <script src="js/easing.min.js"></script>
    <script src="js/hoverIntent.js"></script>
    <script src="js/superfish.min.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.sticky.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/parallax.min.js"></script>
    <script src="js/mail-script.js"></script>
    <script src="js/main.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, serverTimestamp , doc, getDoc, updateDoc, query, where} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        

        const firebaseConfig = {
            apiKey: "AIzaSyByPrDz810_ttwZz0BdAJkeP54rMIqH3uw",
            authDomain: "wad2-505be.firebaseapp.com",
            databaseURL: "https://wad2-505be-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "wad2-505be",
            storageBucket: "wad2-505be.firebasestorage.app",
            messagingSenderId: "221863917439",
            appId: "1:221863917439:web:2a517ca11c83e991388c4a",
            measurementId: "G-L69GG585GF"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const eventList = document.getElementById("event-list");
        let currentUser = null;

        async function loadEvents() {
            eventList.innerHTML = ""; // clear static content
            const snapshot = await getDocs(collection(db, "events"));
            if (snapshot.empty) {
                eventList.innerHTML = `<p class="text-center">No events available yet.</p>`;
                return;
            }

            snapshot.forEach(docSnap => {
                const event = docSnap.data();
                const eventId = docSnap.id;

                let adminControls = "";
                let joinButton = "";

                if (currentUser) {
                    const isCreator = event.creatorId === currentUser.uid;
                    const isAdmin = currentUser.uid === "YOUR_SYSTEM_ADMIN_UID";
            
                    if (isCreator || isAdmin) {
                        adminControls = `
                        <div class="mt-2">
                            <button class="btn btn-sm btn-warning me-1" onclick="editEvent('${eventId}')">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEvent('${eventId}', '${event.name}')">Delete</button>
                            <button class="btn btn-sm btn-success" onclick="viewapplicants('${eventId}', '${event.name}')">View Applicants</button>
                        </div>`;
                    }

                    if (!isCreator) {
                        joinButton = `<button class="btn btn-primary mt-2" onclick="joinEvent('${eventId}', '${event.name}', ${event.rewardPoints})">Join Event</button>`;
                    }
                } else {
                    joinButton = `<p class="text-muted mt-2">Log in to join this event</p>`;
                }

                const eventHTML = `
                <div class="single-post job-listing d-flex flex-row mb-3">
                    <div class="thumb"><img src="img/post.png" alt=""></div>
                    <div class="post-content d-flex flex-column w-100">
                        <div class="details">
                            <div class="title"><a href="#"><h4>${event.name}</h4></a><h6>${event.location}</h6></div>
                            <p>${event.description || "No description provided."}</p>
                            <h5>Manpower Needed: ${event.manpower}</h5>
                            <p class="address"><span class="lnr lnr-map"></span> ${event.location}</p>
                            <p class="address"><span class="lnr lnr-database"></span> ${event.rewardPoints} points</p>
                            ${joinButton}
                            ${adminControls}
                        </div>
                    </div>
                </div>`;
                eventList.insertAdjacentHTML("beforeend", eventHTML);
            });
        }

        window.joinEvent = async (eventId, eventName, rewardPoints) => {
            try {
                // await addDoc(collection(db, "participations"), {
                let userId = currentUser.uid
                const profileRef = collection(db, "profiles")
                const q = query(profileRef, where("userId", "==", userId))
                const querySnapshot = await getDocs(q)
                querySnapshot.forEach((doc) => {
                    console.log(`${doc.id} =>`, doc.data())
                })
                
    
              
                const eventRef = await doc(db, "events", eventId);
                const eventData = await getDoc(eventRef);

                let newPending = eventData.data().pending;
                if(newPending.includes(userId)){
                    alert("You already requested to join the event !")
                }else{
                    newPending.push(userId);
                    alert("You have successfully requested to join the event!")
                    await updateDoc(eventRef, {
                        pending: newPending
                    });

                }

            } catch (err) {
                console.error("Join error:", err);
                alert("Failed to join event.");
            }
        };

        window.deleteEvent = async (eventId, eventName) => {
            if (!confirm(`Are you sure you want to delete "${eventName}"?`)) return;
            try {
                await deleteDoc(doc(db, "events", eventId));
                loadEvents();
                alert(`"${eventName}" has been deleted.`);
            } catch (err) {
                console.error(err);
                alert("Failed to delete event.");
            }
        };

        window.editEvent = (eventId) => {
            window.location.href = `../eventCreation/eventEdit.html?eventId=${eventId}`;
        };

         window.viewapplicants = (eventId) => {
            window.location.href = `../eventCreation/reviewApplicants.html?eventId=${eventId}`;
        };

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
       
            loadEvents();
        });
       
    </script>
</body>

</html>
