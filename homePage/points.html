<!DOCTYPE html>
<html lang="zxx" class="no-js">

<head>
	<!-- Mobile Specific Meta -->
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Favicon-->
	<link rel="shortcut icon" href="img/fav.png">
	<!-- Author Meta -->
	<meta name="author" content="codepixer">
	<!-- Meta Description -->
	<meta name="description" content="">
	<!-- Meta Keyword -->
	<meta name="keywords" content="">
	<!-- meta character set -->
	<meta charset="UTF-8">
	<!-- Site Title -->
	<title>Smuuth Events</title>

	<link href="https://fonts.googleapis.com/css?family=Poppins:100,200,400,300,500,600,700" rel="stylesheet">
	<link rel="stylesheet" href="../homePage/css/custom-alert.css" />
	<!--
			CSS
			============================================= -->
	<link rel="stylesheet" href="css/linearicons.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/bootstrap.css">
	<link rel="stylesheet" href="css/magnific-popup.css">
	<link rel="stylesheet" href="css/nice-select.css">
	<link rel="stylesheet" href="css/animate.min.css">
	<link rel="stylesheet" href="css/owl.carousel.css">
	<link rel="stylesheet" href="css/main.css">
	<style>
		/* Tabs Styling */
		.rewards-tabs-container {
			background: #fff;
			border-radius: 8px;
			box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
			padding: 20px;
			margin-bottom: 20px;
		}

		.rewards-tabs {
			display: flex;
			border-bottom: 2px solid #f9f9ff;
			margin-bottom: 20px;
			gap: 10px;
		}

		.tab-btn {
			flex: 1;
			padding: 12px 20px;
			background: #f9f9ff;
			border: none;
			border-radius: 5px 5px 0 0;
			cursor: pointer;
			font-family: 'Poppins', sans-serif;
			font-weight: 500;
			font-size: 14px;
			color: #222222;
			transition: all 0.3s ease;
			position: relative;
			outline: none;
		}

		.tab-btn:hover {
			background: #e8e8ff;
			color: #49e4fa;
		}

		.tab-btn.active {
			background: #49e4fa;
			color: #fff;
			box-shadow: 0 2px 8px rgba(73, 228, 250, 0.3);
		}

		.tab-btn.active::after {
			content: '';
			position: absolute;
			bottom: -2px;
			left: 0;
			right: 0;
			height: 2px;
			background: #49e4fa;
		}

		/* Rewards List Container */
		#rewardArea {
			max-height: 700px;
			overflow-y: auto;
			overflow-x: hidden;
			padding-right: 10px;
		}

		/* Custom Scrollbar */
		#rewardArea::-webkit-scrollbar {
			width: 8px;
		}

		#rewardArea::-webkit-scrollbar-track {
			background: #f9f9ff;
			border-radius: 10px;
		}

		#rewardArea::-webkit-scrollbar-thumb {
			background: #49e4fa;
			border-radius: 10px;
		}

		#rewardArea::-webkit-scrollbar-thumb:hover {
			background: #38d3e8;
		}

		/* Reward Card Enhancement */
		.single-post.reward-card {
			background: #fff;
			border: 1px solid #f0f0f0;
			border-radius: 8px;
			margin-bottom: 20px;
			transition: all 0.3s ease;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
			padding: 25px;
			min-height: 200px;
		}

		.single-post.reward-card:hover {
			box-shadow: 0 4px 15px rgba(73, 228, 250, 0.2);
			transform: translateY(-2px);
		}

		.single-post.reward-card .thumb {
			padding-right: 20px;
			display: flex;
			align-items: center;
		}

		.single-post.reward-card .thumb img {
			width: 80px !important;
			height: auto !important;
		}

		.single-post.reward-card .post-content {
			padding: 10px 0;
		}

		.single-post.reward-card .details {
			padding: 0 20px !important;
		}

		.single-post.reward-card .title h4 {
			font-size: 20px;
			margin-bottom: 15px;
		}

		.single-post.reward-card p {
			margin-bottom: 12px;
			font-size: 15px;
		}

		.single-post.reward-card .btn {
			padding: 10px 25px;
			font-size: 14px;
			font-weight: 600;
		}

		/* 2 rewards per row */
		.reward-col {
			width: 50%;
			padding: 0 15px;
			margin-bottom: 30px;
		}

		/* Empty State */
		.empty-state {
			text-align: center;
			padding: 60px 20px;
			color: #777777;
		}

		.empty-state i {
			font-size: 64px;
			color: #e0e0e0;
			margin-bottom: 20px;
		}

		.empty-state h4 {
			color: #222222;
			margin-bottom: 10px;
		}

		.empty-state p {
			color: #777777;
		}
	</style>

</head>

<body>
	<div class="custom-alert-overlay" id="customAlertOverlay">
		<div class="custom-alert-box">
			<div class="custom-alert-icon" id="customAlertIcon">
				<i class="fa fa-info-circle"></i>
			</div>
			<h3 class="custom-alert-title" id="customAlertTitle">Alert</h3>
			<p class="custom-alert-message" id="customAlertMessage"></p>
			<div class="custom-alert-btn-group" id="customAlertButtons">
				<button class="custom-alert-btn" id="customAlertOkBtn">OK</button>
			</div>
		</div>
	</div>

	<header id="header" id="home">
		<div class="container">
			<div class="row align-items-center justify-content-between d-flex">
				<div id="logo">
					<a href="index.html"><img src="img/SMUUTH_words_pastel_ultraclean.png" alt="SMUUTH"
							style="height:48px;width:auto;display:block"></a>
				</div>
				<nav id="nav-menu-container">
					<ul class="nav-menu">
						<li class="menu-active"><a href="index.html">Home</a></li>
						<li><a href="about-us.html">About Us</a></li>
						<li><a href="events.html">Events</a></li>
						<li><a href="calendar.html">Calendar</a></li>
						<li><a href="points.html">Points</a></li>
						<li><a class="ticker-btn" href="reviews.html">Feedback Form</a></li>
						<li>
							<a href="../loginPage_file/ViewProfile.html" class="profile-icon-btn" aria-label="Profile">
								<i class="fa fa-user"></i>
							</a>
						</li>
					</ul>
				</nav><!-- #nav-menu-container -->
			</div>
		</div>
	</header><!-- #header -->

	<!-- start banner Area -->
	<section class="banner-area relative" id="home">
		<div class="overlay overlay-bg"></div>
		<div class="container">
			<div class="row d-flex align-items-center justify-content-center">
				<div class="about-content col-lg-12">
					<h1 class="text-white" id="points">
						Points Page
					</h1>
					<!-- <p class="text-white link-nav"><a href="index.html">Home </a>  <span class="lnr lnr-arrow-right"></span>  <a href="blog-home.html"> Blog Posts</a></p> -->
				</div>
			</div>
		</div>
	</section>
	<!-- End banner Area -->

	<!-- Start blog-posts Area -->
	<section class="post-area section-gap">
		<div class="container">
			<!-- Tabs Navigation -->
			<div class="rewards-tabs-container">
				<div class="rewards-tabs">
					<button class="tab-btn active" data-tab="available-rewards">
						<i class="fa fa-gift"></i> Available Rewards
					</button>
					<button class="tab-btn" data-tab="redeemed-rewards">
						<i class="fa fa-check-circle"></i> Redeemed Rewards
					</button>
				</div>
			</div>

			<div class="row justify-content-center d-flex" id="rewardArea">
				<!-- Reward cards go here -->
			</div>
			<div class="row justify-content-center d-flex" id="manageArea">
			</div>
		</div>
	</section>

	<!-- End blog-posts Area -->

	<!-- start footer Area -->
	<footer class="footer-area section-gap">
		<div class="container">
			<div class="row">
				<div class="col-lg-6 col-md-12">
					<div class="single-footer-widget newsletter">
						<h6>Newsletter</h6>
						<p>You can trust us. We only send promo offers, not a single spam.</p>

						<form id="newsletter-form">
							<div class="form-group row" style="width: 100%">
								<div class="col-lg-8 col-md-12">
									<input name="to_email" placeholder="Enter Email" onfocus="this.placeholder=''"
										onblur="this.placeholder='Enter Email'" required type="email" />
								</div>

								<div class="col-lg-4 col-md-12">
									<button type="submit" class="nw-btn primary-btn">
										Subscribe<span class="lnr lnr-arrow-right"></span>
									</button>
								</div>
							</div>

							<div class="info" id="newsletter-response"></div>
						</form>
					</div>
				</div>
			</div>

			<div class="row footer-bottom d-flex justify-content-between">
				<p class="col-lg-8 col-sm-12 footer-text m-0 text-white">
					Copyright &copy;
					<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is
					made with <i class="fa fa-heart-o" aria-hidden="true"></i> by
					<a href="https://colorlib.com" target="_blank">Colorlib</a>
				</p>
				<div class="col-lg-4 col-sm-6 footer-social">
					<a href="https://www.facebook.com/people/SMUuth-Events/61583632431022/"><img
							src="img/facebook logo.svg" alt="facebook logo" class="socialLogo"></a>
					<a href="https://www.tiktok.com/en/"><img src="img/tiktok logo.png.svg" alt="tiktok logo"
							class="socialLogo"></a>
					<a href="https://www.instagram.com/smuuthevents?igsh=ZTJ2OWs2MHB2OW94&utm_source=qr">
						<img src="img/instagram logo.svg" alt="instagram logo" class="socialLogo">
					</a>
				</div>
			</div>
		</div>
	</footer>

	<!-- EmailJS v4 (load once, below your other scripts) -->
	<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
	<script>
		(function () {
			emailjs.init("VKk3x4Hb19VUPRuAh"); // Replace with your EmailJS public key
		})();

		document.getElementById('newsletter-form').addEventListener('submit', function (event) {
			event.preventDefault();

			const btn = this.querySelector('button[type="submit"]');
			const responseDiv = document.getElementById('newsletter-response');
			const originalBtnHtml = btn.innerHTML;

			// Disable button and show loading
			btn.disabled = true;
			btn.innerHTML = 'Sending...';
			responseDiv.innerHTML = '';

			// Send email using EmailJS
			emailjs.sendForm('service_qxa591g', 'template_4ql5kl9', this)
				.then(function (response) {
					console.log('Newsletter subscription successful!', response.status, response.text);
					responseDiv.innerHTML = '<p style="color: #4CAF50; margin-top: 10px;">✓ Successfully subscribed!</p>';
					document.getElementById('newsletter-form').reset();

					setTimeout(function () {
						btn.disabled = false;
						btn.innerHTML = originalBtnHtml;
						responseDiv.innerHTML = '';
					}, 3000);
				}, function (error) {
					console.log('Newsletter subscription failed:', error);
					responseDiv.innerHTML = '<p style="color: #f44336; margin-top: 10px;">✗ Failed to subscribe. Please try again.</p>';

					btn.disabled = false;
					btn.innerHTML = originalBtnHtml;
				});
		});
	</script>
	<!-- End footer Area -->

	<script src="js/vendor/jquery-2.2.4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
		integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
		crossorigin="anonymous"></script>
	<script src="js/vendor/bootstrap.min.js"></script>
	<script src="js/easing.min.js"></script>
	<script src="js/hoverIntent.js"></script>
	<script src="js/superfish.min.js"></script>
	<script src="js/jquery.ajaxchimp.min.js"></script>
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/jquery.sticky.js"></script>
	<script src="js/jquery.nice-select.min.js"></script>
	<script src="js/parallax.min.js"></script>
	<script src="js/mail-script.js"></script>
	<script src="js/main.js"></script>

	<script type="module">
		// check if login
		import { checkLogin } from "../loginPage_file/authenticate.js";

		checkLogin()

		import { getPoints } from '../points/points.js'
		// getting the profileid
		let profileID = localStorage.getItem('profileID');
		// console.log(profileID);
		//populating the points
		let h1 = document.getElementById("points")
		let points = await getPoints(profileID)
		if (points != null) {
			h1.innerText = "Your Points: " + points
		}

		import { getAllRewards, redeemReward, getRole } from '../reward/reward.js'
		let row = document.getElementById('rewardArea')
		let rewardList = await getAllRewards();
		let role = await getRole(profileID);



		// iterate through the reward list and populate the screen
		for (let reward of rewardList) {
			// Check if user has redeemed this reward
			const hasRedeemed = reward.data.redeemedUser && reward.data.redeemedUser.includes(profileID);

			// Create column wrapper for 2 per row layout
			let col = document.createElement("div");
			col.setAttribute('class', 'reward-col');
			col.setAttribute('data-redeemed', hasRedeemed ? 'true' : 'false');
			row.appendChild(col);

			// Create card with event-like structure
			const card = document.createElement('div');
			card.className = 'single-post reward-card d-flex flex-row';
			col.appendChild(card);

			// Thumbnail
			const thumb = document.createElement('div');
			thumb.className = 'thumb';
			const img = document.createElement('img');
			img.className = 'img-fluid';
			img.src = './img/SMUUTH_words_pastel_ultraclean.png';
			img.style = "height:48px;width:auto;display:block";
			img.alt = 'logo.png';
			thumb.appendChild(img);
			card.appendChild(thumb);

			// Post content wrapper
			const postContent = document.createElement('div');
			postContent.className = 'post-content d-flex flex-column w-100';
			card.appendChild(postContent);

			// Details section
			const details = document.createElement('div');
			details.className = 'details px-4';
			postContent.appendChild(details);

			// Title
			const titleDiv = document.createElement('div');
			titleDiv.className = 'title';
			const a = document.createElement('a');
			a.href = '#';
			const h4 = document.createElement('h4');
			h4.textContent = reward.data.rewardName;
			a.appendChild(h4);
			titleDiv.appendChild(a);
			details.appendChild(titleDiv);

			// Points required
			const pointsLine = document.createElement('p');
			pointsLine.className = 'address';
			pointsLine.innerHTML = `<span class="lnr lnr-database"></span> ${reward.data.pointsAmount} points`;
			details.appendChild(pointsLine);

			// Redeem limit info
			const limitLine = document.createElement('p');
			limitLine.innerHTML = `<strong>Available:</strong> ${reward.data.redeemLimit - (reward.data.redeemedUser ? reward.data.redeemedUser.length : 0)} / ${reward.data.redeemLimit}`;
			details.appendChild(limitLine);

			// Redeem button
			const btnDiv = document.createElement('div');
			btnDiv.className = 'mt-2';
			const redeemBtn = document.createElement('button');
			redeemBtn.className = 'btn btn-primary';

			if (hasRedeemed) {
				redeemBtn.textContent = 'Redeemed';
				redeemBtn.className = 'btn btn-success';
				redeemBtn.disabled = true;
				redeemBtn.style.cursor = 'not-allowed';
			} else {
				redeemBtn.textContent = 'Redeem';
				redeemBtn.addEventListener('click', (e) => {
					e.preventDefault();
					redeemReward(reward.id, profileID);
				});
			}

			btnDiv.appendChild(redeemBtn);
			details.appendChild(btnDiv);
		}

		if (role == 'systemAdmin') {
			let button = document.createElement("button")
			button.setAttribute("class", "btn btn-danger")
			button.innerText = "Manage Reward"
			let area = document.getElementById("manageArea");
			area.appendChild(button)

			button.addEventListener('click', () => {
				window.location.replace('manageReward.html');
			})
		}

		function showCustomConfirm(message, title = 'Confirm') {
			return new Promise((resolve) => {
				const overlay = document.getElementById('customAlertOverlay');
				const icon = document.getElementById('customAlertIcon');
				const titleEl = document.getElementById('customAlertTitle');
				const messageEl = document.getElementById('customAlertMessage');
				const buttonsContainer = document.getElementById('customAlertButtons');

				// Set icon for confirmation
				icon.innerHTML = '<i class="fa fa-question-circle"></i>';
				icon.className = 'custom-alert-icon warning';

				// Set title and message
				titleEl.textContent = title;
				messageEl.textContent = message;

				// Create Yes/No buttons
				buttonsContainer.innerHTML = `
                    <button class="custom-alert-btn secondary" id="customAlertNoBtn">Cancel</button>
                    <button class="custom-alert-btn" id="customAlertYesBtn">Confirm</button>
                `;

				// Show overlay
				overlay.classList.add('show');

				const yesBtn = document.getElementById('customAlertYesBtn');
				const noBtn = document.getElementById('customAlertNoBtn');

				const handleYes = () => {
					overlay.classList.remove('show');
					cleanup();
					resolve(true);
				};

				const handleNo = () => {
					overlay.classList.remove('show');
					cleanup();
					resolve(false);
				};

				const cleanup = () => {
					yesBtn.removeEventListener('click', handleYes);
					noBtn.removeEventListener('click', handleNo);
					overlay.removeEventListener('click', handleOverlayClick);
					// Reset to single OK button
					buttonsContainer.innerHTML = '<button class="custom-alert-btn" id="customAlertOkBtn">OK</button>';
				};

				const handleOverlayClick = (e) => {
					if (e.target === overlay) {
						handleNo();
					}
				};

				yesBtn.addEventListener('click', handleYes);
				noBtn.addEventListener('click', handleNo);
				overlay.addEventListener('click', handleOverlayClick);
			});
		}

		// Tab filtering functions
		function initializeTabs() {
			const tabButtons = document.querySelectorAll('.tab-btn');

			tabButtons.forEach(button => {
				button.addEventListener('click', function (e) {
					e.preventDefault();

					// Remove active class from all buttons
					tabButtons.forEach(btn => btn.classList.remove('active'));
					// Add active class to clicked button
					this.classList.add('active');

					// Get the tab type
					const tabType = this.getAttribute('data-tab');

					// Apply the appropriate filter
					filterRewardsByTab(tabType);
				});
			});
		}

		function filterRewardsByTab(tabType) {
			const allRewardCards = document.querySelectorAll('.reward-col');
			let shown = 0;

			allRewardCards.forEach(card => {
				const isRedeemed = card.getAttribute('data-redeemed') === 'true';
				let shouldShow = false;

				if (tabType === 'available-rewards') {
					// Show only rewards that haven't been redeemed
					shouldShow = !isRedeemed;
				} else if (tabType === 'redeemed-rewards') {
					// Show only rewards that have been redeemed
					shouldShow = isRedeemed;
				}

				if (shouldShow) {
					card.style.display = 'inline-block';
					shown++;
				} else {
					card.style.display = 'none';
				}
			});

			// Show empty state if no rewards
			showEmptyState(tabType, shown);
		}

		function showEmptyState(tabType, count) {
			let empty = document.getElementById('rewards-empty-state');

			if (count === 0) {
				if (!empty) {
					empty = document.createElement('div');
					empty.id = 'rewards-empty-state';
					empty.className = 'empty-state';
					empty.style.width = '100%';
				}

				let emptyMessage = '';
				let emptyIcon = 'fa-gift';

				if (tabType === 'available-rewards') {
					emptyMessage = '<h4>No Available Rewards</h4><p>All rewards have been redeemed or there are no rewards at the moment.</p>';
					emptyIcon = 'fa-gift';
				} else if (tabType === 'redeemed-rewards') {
					emptyMessage = '<h4>No Redeemed Rewards</h4><p>You haven\'t redeemed any rewards yet. Check out the available rewards!</p>';
					emptyIcon = 'fa-check-circle';
				}

				empty.innerHTML = `<i class="fa ${emptyIcon}"></i>${emptyMessage}`;
				document.getElementById('rewardArea').appendChild(empty);
			} else if (empty) {
				empty.remove();
			}
		}

		// Initialize tabs after rewards are loaded
		initializeTabs();
		// Show available rewards by default
		filterRewardsByTab('available-rewards');
	</script>
</body>

</html>