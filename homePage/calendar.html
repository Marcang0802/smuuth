<!DOCTYPE html>
<html lang="zxx" class="no-js">

<head>
	<!-- Mobile Specific Meta -->
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Favicon-->
	<link rel="shortcut icon" href="img/fav.png">
	<!-- Author Meta -->
	<meta name="author" content="codepixer">
	<!-- Meta Description -->
	<meta name="description" content="">
	<!-- Meta Keyword -->
	<meta name="keywords" content="">
	<!-- meta character set -->
	<meta charset="UTF-8">
	<!-- Site Title -->
	<title>Smuuth Events</title>

	<link href="https://fonts.googleapis.com/css?family=Poppins:100,200,400,300,500,600,700" rel="stylesheet">
	<!--
			CSS
			============================================= -->
	<link rel="stylesheet" href="css/linearicons.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/bootstrap.css">
	<link rel="stylesheet" href="css/magnific-popup.css">
	<link rel="stylesheet" href="css/nice-select.css">
	<link rel="stylesheet" href="css/animate.min.css">
	<link rel="stylesheet" href="css/owl.carousel.css">
	<link rel="stylesheet" href="css/main.css">
	<style>
		.calendar-legend {
			background: #fff;
			border-radius: 8px;
			box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
			padding: 20px;
			margin-bottom: 20px;
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 30px;
			flex-wrap: wrap;
		}

		.legend-item {
			display: flex;
			align-items: center;
			gap: 10px;
			font-family: 'Poppins', sans-serif;
		}

		.legend-color {
			width: 30px;
			height: 20px;
			border-radius: 4px;
		}

		.legend-color.joined {
			background-color: #49e4fa;
		}

		.legend-color.created {
			background-color: #4CAF50;
		}

		.legend-text {
			font-size: 14px;
			font-weight: 500;
			color: #222222;
		}

		/* Calendar container styling */
		.calendar-api {
			background: #fff;
			padding: 20px;
			border-radius: 8px;
			box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
		}

		#calendar {
			min-height: 600px;
		}
	</style>
</head>

<body>

	<header id="header" id="home">
		<div class="container">
			<div class="row align-items-center justify-content-between d-flex">
				<div id="logo">
					<a href="index.html"><img src="img/SMUUTH_words_pastel_ultraclean.png" alt="SMUUTH"
							style="height:48px;width:auto;display:block"></a>
				</div>
				<nav id="nav-menu-container">
					<ul class="nav-menu">
						<li class="menu-active"><a href="index.html">Home</a></li>
						<li><a href="about-us.html">About Us</a></li>
						<li><a href="events.html">Events</a></li>
						<li><a href="calendar.html">Calendar</a></li>
						<li><a href="points.html">Points</a></li>
						<li><a class="ticker-btn" href="reviews.html">Feedback Form</a></li>
						<li>
							<a href="../loginPage_file/ViewProfile.html" class="profile-icon-btn" aria-label="Profile">
								<i class="fa fa-user"></i>
							</a>
						</li>
						<!-- <li class="menu-has-children"><a href="">Pages</a>
				            <ul>
								<li><a href="elements.html">elements</a></li>
								<li><a href="search.html">search</a></li>
								<li><a href="single.html">single</a></li> -->
						<!-- <li><a class="ticker-btn" href="#">Signup</a></li> -->

					</ul>
				</nav><!-- #nav-menu-container -->
			</div>
		</div>
	</header><!-- #header -->


	<!-- start banner Area -->
	<section class="banner-area relative" id="home">
		<div class="overlay overlay-bg"></div>
		<div class="container">
			<div class="row d-flex align-items-center justify-content-center">
				<div class="about-content col-lg-12">
					<h1 class="text-white">
						Calendar
					</h1>
					<!-- <p class="text-white link-nav"><a href="index.html">Home </a>  <span class="lnr lnr-arrow-right"></span>  <a href="price.html"> Pricing Plan</a></p> -->
				</div>
			</div>
		</div>
	</section>
	<!-- End banner Area -->

	<!-- Start price Area -->
	<section class="price-area section-gap" id="price">
		<div class="container">
			<div class="row d-flex justify-content-center">
				<div class="menu-content pb-60 col-lg-8">
					<div class="title text-center">
						<h1 class="mb-10">View calendar of events</h1>
						<!-- <p>Who are in extremely love with eco friendly system.</p> -->
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<!-- Calendar Legend -->
					<div class="calendar-legend">
						<div class="legend-item">
							<div class="legend-color joined"></div>
							<span class="legend-text">Events You Joined</span>
						</div>
						<div class="legend-item">
							<div class="legend-color created"></div>
							<span class="legend-text">Events You Created</span>
						</div>
					</div>
					<div class="calendar-api">
						<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js'></script>
						<script type="module">
							import { getAllJoinedEvents, getAllCreatedEvents } from '../calendar/calender.js';
							import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
							import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";

							const firebaseConfig = {
								apiKey: "AIzaSyByPrDz810_ttwZz0BdAJkeP54rMIqH3uw",
								authDomain: "wad2-505be.firebaseapp.com",
								databaseURL: "https://wad2-505be-default-rtdb.asia-southeast1.firebasedatabase.app",
								projectId: "wad2-505be",
								storageBucket: "wad2-505be.firebasestorage.app",
								messagingSenderId: "221863917439",
								appId: "1:221863917439:web:2a517ca11c83e991388c4a",
								measurementId: "G-L69GG585GF"
							};

							const app = initializeApp(firebaseConfig);
							const auth = getAuth(app);

							document.addEventListener('DOMContentLoaded', async function () {
								console.log('Calendar page loaded');
								let profileID = localStorage.getItem('profileID');
								console.log('ProfileID:', profileID);

								// Wait for auth state
								onAuthStateChanged(auth, async (user) => {
									if (user) {
										console.log('User authenticated:', user.uid);
										try {
											// Get both joined and created events
											let joinedEvents = await getAllJoinedEvents(profileID);
											console.log('Joined events:', joinedEvents);

											let createdEvents = await getAllCreatedEvents(user.uid);
											console.log('Created events:', createdEvents);

											// Map joined events to calendar format (blue color)
											let joinedCalendarEvents = joinedEvents.map(event => ({
												title: event.eventName + ' (Joined)',
												start: event.start.split('T')[0],
												end: event.end.split('T')[0],
												allDay: true,
												color: '#49e4fa', // Light blue for joined events
												textColor: '#ffffff'
											}));

											// Map created events to calendar format (green color)
											let createdCalendarEvents = createdEvents.map(event => ({
												title: event.eventName + ' (Created)',
												start: event.start.split('T')[0],
												end: event.end.split('T')[0],
												allDay: true,
												color: '#4CAF50', // Green for created events
												textColor: '#ffffff'
											}));

											// Combine both event arrays
											let allCalendarEvents = [...joinedCalendarEvents, ...createdCalendarEvents];
											console.log('Total calendar events:', allCalendarEvents.length);

											// Initialize calendar
											var calendarEl = document.getElementById('calendar');
											if (!calendarEl) {
												console.error('Calendar element not found!');
												return;
											}
											console.log('Initializing calendar...');

											var calendar = new FullCalendar.Calendar(calendarEl, {
												initialView: 'dayGridMonth',
												events: allCalendarEvents,
												headerToolbar: {
													left: 'prev,next today',
													center: 'title',
													right: 'dayGridMonth,timeGridWeek,listWeek'
												},
												height: 'auto'
											});
											calendar.render();
											console.log('Calendar rendered successfully');
										} catch (error) {
											console.error('Error loading calendar:', error);
										}
									} else {
										console.log('No user authenticated');
									}
								});
							});

						</script>

						<div id='calendar'></div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- End price Area -->

	<!-- Start submit Area -->
	<section class="submit-area section-gap" style="background-color:whitesmoke;">
		<div class="container">
			<div class="row">
				<div class="col-lg-6">
					<div class="submit-left">
						<h4>Find Helpers</h4>
						<p>
							Post your needs and get verified helpers in minutes.
						</p>
						<a href="../eventCreation/eventCreate.html" class="primary-btn header-btn">Post a Job</a>
					</div>
				</div>
				<div class="col-lg-6 ">
					<div class="submit-right">
						<h4>Find Events</h4>
						<p>
							Explore what’s happening around campus today.
						</p>
						<a href="../homePage/events.html" class="primary-btn header-btn">Find Events</a>
					</div>
				</div>

			</div>
		</div>
	</section>
	<!-- End submit Area -->


	<!-- start footer Area -->
	<footer class="footer-area section-gap">
  <div class="container">
    <div class="row">
      <div class="col-lg-6 col-md-12">
        <div class="single-footer-widget newsletter">
          <h6>Newsletter</h6>
          <p>You can trust us. We only send promo offers, not a single spam.</p>

          <form id="newsletter-form">
            <div class="form-group row" style="width: 100%">
              <div class="col-lg-8 col-md-12">
                <input
                  name="to_email"
                  placeholder="Enter Email"
                  onfocus="this.placeholder=''"
                  onblur="this.placeholder='Enter Email'"
                  required
                  type="email"
                />
              </div>

              <div class="col-lg-4 col-md-12">
                <button type="submit" class="nw-btn primary-btn">
                  Subscribe<span class="lnr lnr-arrow-right"></span>
                </button>
              </div>
            </div>

            <div class="info" id="newsletter-response"></div>
          </form>
        </div>
      </div>
    </div>

    <div class="row footer-bottom d-flex justify-content-between">
      <p class="col-lg-8 col-sm-12 footer-text m-0 text-white">
        Copyright &copy;
        <script>document.write(new Date().getFullYear());</script> All rights reserved | This template is
        made with <i class="fa fa-heart-o" aria-hidden="true"></i> by
        <a href="https://colorlib.com" target="_blank">Colorlib</a>
      </p>
      <div class="col-lg-4 col-sm-12 footer-social">
        <a href="#"><i class="fa fa-facebook"></i></a>
        <a href="#"><img src="img/tiktok logo.png.svg" alt="tiktok logo"></a>
        <a href="https://www.instagram.com/smuuthevents?igsh=ZTJ2OWs2MHB2OW94&utm_source=qr"><i class="fa fa-instagram"></i></a>
      </div>
    </div>
  </div>
</footer>

<!-- EmailJS v4 (load once, below your other scripts) -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  (function () {
    emailjs.init("VKk3x4Hb19VUPRuAh"); // Replace with your EmailJS public key
  })();

  document.getElementById('newsletter-form').addEventListener('submit', function (event) {
    event.preventDefault();

    const btn = this.querySelector('button[type="submit"]');
    const responseDiv = document.getElementById('newsletter-response');
    const originalBtnHtml = btn.innerHTML;

    // Disable button and show loading
    btn.disabled = true;
    btn.innerHTML = 'Sending...';
    responseDiv.innerHTML = '';

    // Send email using EmailJS
    emailjs.sendForm('service_qxa591g', 'template_4ql5kl9', this)
      .then(function (response) {
        console.log('Newsletter subscription successful!', response.status, response.text);
        responseDiv.innerHTML = '<p style="color: #4CAF50; margin-top: 10px;">✓ Successfully subscribed!</p>';
        document.getElementById('newsletter-form').reset();

        setTimeout(function () {
          btn.disabled = false;
          btn.innerHTML = originalBtnHtml;
          responseDiv.innerHTML = '';
        }, 3000);
      }, function (error) {
        console.log('Newsletter subscription failed:', error);
        responseDiv.innerHTML = '<p style="color: #f44336; margin-top: 10px;">✗ Failed to subscribe. Please try again.</p>';

        btn.disabled = false;
        btn.innerHTML = originalBtnHtml;
      });
  });
</script>
	<!-- End footer Area -->

	<script src="js/vendor/jquery-2.2.4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
		integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
		crossorigin="anonymous"></script>
	<script src="js/vendor/bootstrap.min.js"></script>
	<script src="js/easing.min.js"></script>
	<script src="js/hoverIntent.js"></script>
	<script src="js/superfish.min.js"></script>
	<script src="js/jquery.ajaxchimp.min.js"></script>
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/jquery.sticky.js"></script>
	<script src="js/jquery.nice-select.min.js"></script>
	<script src="js/parallax.min.js"></script>
	<script src="js/mail-script.js"></script>
	<script src="js/main.js"></script>
</body>

</html>
